<!--
  ~ Copyright (c) 2019-2022 YunLong Chen
  ~ Project Qing is licensed under Mulan PSL v2.
  ~ You can use this software according to the terms and conditions of the Mulan PSL v2.
  ~ You may obtain a copy of Mulan PSL v2 at:
  ~          http://license.coscl.org.cn/MulanPSL2
  ~ THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  ~ EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  ~ MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  ~ See the Mulan PSL v2 for more details.
  ~
  -->

<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>登录 - 看看看动漫</title>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/shangzhenyang/assets/img/rth.png" as="image">
    <link rel="stylesheet" th:href="@{{host}/css/login.css(host=${hostname})}">
    <link rel="shortcut icon" th:href="@{{host}/img/logo.jpg(host=${hostname})}">
</head>
<body class="">
<img class="bg bg-img" alt="" th:src="@{{host}/img/loginbg.jpg(host=${hostname})}" src="">
<div class="bg bg-cover"></div>
<main>
    <div class="icon" th:style="'background-image:url(/img/logo.jpg)'"></div>
    <input id="username" name="username" type="text" placeholder="电子邮箱/手机号/用户名">
    <input id="password" name="password" type="password" autocomplete="current-password" placeholder="密码">
    <input id="ConfirmPassword" type="password" autocomplete="new-password" placeholder="确认密码" class="hidden">
    <button onclick="handleBtn()">登录</button>

    <div class="switch">
        <a id="LoginWithGithub" tabindex="0" role="checkbox" aria-checked="true" href="/authorize/login">Github</a>|
        <a id="Login" tabindex="0" role="checkbox" aria-checked="true">登录</a> |
        <a id="SignUp" tabindex="0" role="checkbox" aria-checked="false">注册</a> |
        <a id="ResetPassword" tabindex="0" role="checkbox" aria-checked="false">重置密码</a>
    </div>
</main>
<footer><a href="https://www.chenyunlong.cn/tos" target="_blank" aria-checked="false">服务条款</a> | <a
        href="https://www.chenyunlong.cn/privacy" target="_blank" aria-checked="false">隐私政策</a><br>© 2020 Stanic
    保留所有权利
</footer>
<script type="text/javascript" async="" th:src="@{{host}/js/recaptcha__zh_cn.js(host=${hostname})}"
        crossorigin="anonymous"
        integrity="sha384-BIGQylPzasl2JE1lXL3Ox8SMxzx9gGaw4q7PrkA2RNRMoUu7WhWYJuosFBWwzYsl"></script>
<script th:src="@{{host}/js/i18n.js(host=${hostname})}"></script>
<script th:src="@{{host}/js/cookies.js(host=${hostname})}"></script>
<script th:src="@{{host}/js/axios.js(host=${hostname})}"></script>
<script type="application/javascript">
    //获取参数封装
    function GetParam(name) {
        //设置正则表达式
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        // 设置或返回从问号 (?) 开始的 URL（查询部分）
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            // 解码一个编码的 URI 组件。
            return decodeURIComponent(r[2]);
        }
        return null;
    }

    function handleBtn() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        axios.post('/authorize/formLogin', {
            username: username,
            password: password
        }).then(function (response) {
            if (response.data.code === 0) {
                var exp = new Date();
                exp.setTime(exp.getTime() + (30 * 24 * 60 * 60 * 1000));
                docCookies.setItem("zhangli_token", response.data.data.token, exp, "/")
                localStorage.setItem("userInfo", JSON.stringify(response.data.data))
                const query = GetParam("redirect_to")
                if (query !== undefined && query !== null && query !== '') {
                    location.href = query;
                } else {
                    location.href = "/"
                }
            } else {
                alert(response.data.msg)
            }
        }).catch(function (error) {
            console.log(error.data)
            docCookies.removeItem("zhangli_token", "/")
        });
    }

    function __setCookie(name, value, _in_days) {
        var Days = _in_days;
        var exp = new Date();
        exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
        document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString() + ";path=/";
    }
</script>
<script async="" defer="" th:src="@{{host}/js/jsencrypt.min.js(host=${hostname})}"></script>
<script async="" defer="" th:src="@{{host}/js/md5.min.js(host=${hostname})}"></script>
<script th:src="@{{host}/js/api.js(host=${hostname})}"></script>
<div>
    <div class="grecaptcha-badge" data-style="bottomright"
         style="width: 256px; height: 60px; display: block; transition: right 0.3s ease 0s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0 0 5px; border-radius: 2px; overflow: hidden;">
        <div class="grecaptcha-logo">
            <iframe th:src="@{{host}/css/anchor.html(host=${hostname})}" width="256" height="60" role="presentation"
                    name="a-vvha94wiqg42"
                    sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox"></iframe>
        </div>
        <div class="grecaptcha-error"></div>
        <label for="g-recaptcha-response"></label>
        <textarea id="g-recaptcha-response" name="g-recaptcha-response" class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0; resize: none; display: none;">

        </textarea>
    </div>
    <iframe style="display: none;" th:src="@{{host}/css/saved_resource(1).html(host=${hostname})}"></iframe>
</div>
<div style="visibility: hidden; position: absolute; width: 100%; top: -10000px; left: 0; right: 0; transition: visibility 0s linear 0.3s, opacity 0.3s linear 0s; opacity: 0;">
    <div style="width: 100%; height: 100%; position: fixed; top: 0; left: 0; z-index: 2000000000; background-color: rgb(255, 255, 255); opacity: 0.5;"></div>
    <div style="margin: 0 auto; top: 0; left: 0; right: 0; position: absolute; border: 1px solid rgb(204, 204, 204); z-index: 2000000000; background-color: rgb(255, 255, 255); overflow: hidden;">
        <iframe title="reCAPTCHA 验证" th:src="@{{host}/css/bframe.html(host=${hostname})}" name="c-vvha94wiqg42"
                frameborder="0"
                scrolling="no"
                sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox"
                style="width: 100%; height: 100%;">
        </iframe>
    </div>
</div>
</body>
</html>
